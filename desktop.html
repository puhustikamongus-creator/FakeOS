<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows 11 WebOS - Desktop</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="js/apps.js"></script>
    <script src="js/system.js"></script>
</head>
<body>

    <svg width="0" height="0">
        <defs>
            <linearGradient id="win11-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#0080FF;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#00FFFF;stop-opacity:1" />
            </linearGradient>
            <filter id="shadow">
                <feDropShadow dx="0" dy="2" stdDeviation="2" flood-color="rgba(0, 0, 0, 0.5)"/>
            </filter>
        </defs>
    </svg>

    <div id="desktop">
        <div class="desktop-icon" onclick="openAppWindow('File Explorer', 'apps/explorer.html')"><i class="fas fa-desktop"></i><span>Этот компьютер</span></div>
        <div class="desktop-icon" onclick="openAppWindow('Recycle Bin', 'apps/recycle-bin.html')"><i class="fas fa-trash"></i><span>Корзина</span></div>
        
        <div id="start-menu">
            <div id="start-menu-footer">
                <button onclick="window.location.href='index.html'"><i class="fas fa-power-off"></i> Выход</button>
            </div>
        </div>
        
        <div id="taskbar">
            <div id="taskbar-left" class="taskbar-section">
                <div id="start-button" class="taskbar-icon" onclick="toggleStartMenu()">
                    <svg id="start-button-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="0" y="0" width="24" height="24" fill="none" filter="url(#shadow)"/>
                        <rect class="square" x="2.5" y="2.5" width="9" height="9" rx="1.5" ry="1.5" fill="url(#win11-gradient)"/>
                        <rect class="square" x="12.5" y="2.5" width="9" height="9" rx="1.5" ry="1.5" fill="url(#win11-gradient)"/>
                        <rect class="square" x="2.5" y="12.5" width="9" height="9" rx="1.5" ry="1.5" fill="url(#win11-gradient)"/>
                        <rect class="square" x="12.5" y="12.5" width="9" height="9" rx="1.5" ry="1.5" fill="url(#win11-gradient)"/>
                    </svg>
                </div>
            </div>

            <div id="taskbar-center">
                <div id="taskbar-apps">
                    <div id="taskbar-icon-explorer" class="taskbar-icon" onclick="openAppWindow('File Explorer', 'apps/explorer.html')"><i class="fas fa-folder"></i></div>
                    <div id="taskbar-icon-browser" class="taskbar-icon" onclick="openAppWindow('Edge Browser', 'apps/browser.html')"><i class="fab fa-edge"></i></div>
                    <div id="taskbar-icon-telegram" class="taskbar-icon" onclick="openAppWindow('Telegram', 'apps/telegram.html')"><i class="fab fa-telegram-plane"></i></div>
                    </div>
            </div>

            <div id="taskbar-right">
                <div class="taskbar-info">
                    <span id="taskbar-time"></span>
                    <span id="taskbar-date"></span>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Инициализация window.desktop в system.js
        window.desktop = document.getElementById('desktop');
        
        window.appIcons = {
            'File Explorer': 'fas fa-folder',
            'Edge Browser': 'fab fa-edge',
            'Telegram': 'fab fa-telegram-plane',
            'Recycle Bin': 'fas fa-trash'
        };

// Запуск IndexedDB при загрузке рабочего стола
    initFileSystem(); 
    
    // Инициализация иконок
    initializeDesktopIcons(); // Теперь иконки создаются динамически
    initializeTaskbarIcons(); 
    
    // Удаляем старые, статичные иконки из HTML, они теперь создаются JS
    // (Убедитесь, что вы удалили старые статические иконки из тела desktop.html)

    function toggleStartMenu() {
        // ... (Логика открытия/закрытия меню Пуск) ...
    }
    
    function updateTaskbarTime() {
        // ... (Логика обновления времени на Taskbar) ...
    }
    setInterval(updateTaskbarTime, 1000);
</script>
</body>
</html>